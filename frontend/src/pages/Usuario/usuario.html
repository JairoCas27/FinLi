<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FinLi - Usuario</title>
    <link rel="icon" href="/frontend/public/img/Logo/LogoFinLi.png" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/frontend/src/pages/Usuario/usuario.css">
</head>
<body>
    <div class="container-fluid">
        <div class="app-shell">
            <!-- SIDEBAR -->
            <aside class="sidebar fade-in">
                <div class="brand">
                    <img src="/frontend/public/img/Logo/LogoFinLi.png" alt="Logo" width="44" height="44">
                    <div>
                        <h3>FinLi</h3>
                        <div class="text-muted" style="font-size:.85rem">Panel de usuario</div>
                    </div>
                </div>

                <!-- Navegación principal -->
                <nav class="mt-3">
                    <a class="nav-link active" data-section="inicio"><i class="bi bi-house-door-fill"></i> Inicio</a>
                    <a class="nav-link" data-section="informes"><i class="bi bi-graph-up"></i> Informes</a>
                    <a class="nav-link" data-section="perfil"><i class="bi bi-person-fill"></i> Perfil</a>
                </nav>

                <div class="mt-4">
                    <a href="/frontend/src/pages/Autenticación/login.html">
                        <button class="btn btn-outline-secondary btn-logout">
                            <i class="bi bi-box-arrow-right me-2"></i> Cerrar sesión
                        </button>
                    </a>
                </div>

                <div class="sidebar-footer text-muted small">
                    <div>FinLi © <span id="year"></span></div>
                    <div>Versión 1.0</div>
                </div>
            </aside>

            <!-- MAIN -->
            <main class="main">
                <!-- TOPBAR -->
                <div class="topbar">
                    <div>
                        <h2 class="mb-0" id="main-title">Bienvenido, <span class="text-gradient">Usuario</span></h2>
                        <small class="muted" id="main-subtitle">Panel de control personal</small>
                    </div>

                    <div class="d-flex align-items-center gap-3">
                        <div class="search-box d-none d-md-block">
                            <!-- Buscador para filtrar transacciones por texto -->
                            <input class="form-control form-control-sm" placeholder="Buscar transacciones..." id="search-input" />
                        </div>
                        
                        <!-- Notifications Dropdown -->
                        <div class="dropdown">
                            <button class="btn btn-sm btn-light position-relative dropdown-toggle" type="button" id="notificationsDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="bi bi-bell"></i>
                                <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" style="font-size: 0.6rem;">
                                0
                                </span>
                            </button>
                            <ul class="dropdown-menu dropdown-notifications dropdown-menu-end" aria-labelledby="notificationsDropdown">
                                <li>
                                    <h6 class="dropdown-header">Notificaciones</h6>
                                </li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item text-center small" href="#">Ver todas las notificaciones</a></li>
                            </ul>
                        </div>
                        
                        <!-- Avatar y datos rápidos del usuario -->
                        <div class="d-flex align-items-center gap-2">
                            <div class="avatar-sm" style="background:linear-gradient(135deg,var(--verdeOs),var(--grisOs))">
                                <img id="userAvatarSmall" src="" alt="Usuario" onerror="this.style.display='none'">
                                <span id="userInitials">JC</span>
                            </div>
                            <div class="text-end d-none d-sm-block">
                                <div id="quickProfileName"  style="font-weight:600">Usuario</div>
                                <small class="muted" id="quickProfileEmail">correo@ejemplo.com</small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SECCIÓN INICIO -->
                <section id="inicio" class="content-section active">
                    <!-- Balance Card -->
                    <div class="balance-card fade-in">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <div class="balance-label">Balance Total</div>
                                <div class="balance-amount">S/. 0.00</div>
                                <div class="balance-label mt-2">+ S/. 0.00 este mes</div>
                            </div>
                            <div class="text-end">
                                <div class="balance-label">Ingresos</div>
                                <div class="fs-4 fw-bold">S/. 0.00</div>
                                <div class="balance-label mt-2">Gastos</div>
                                <div class="fs-4 fw-bold">S/. 0.00</div>
                            </div>
                        </div>
                    </div>

                    <!-- AÑADIR TRANSACCIÓN-->
                    <div class="card-stat fade-in mb-4">
                        <h5 class="d-flex align-items-center gap-2 mb-3">
                            <i class="bi bi-plus-circle text-primary"></i> Añadir Transacción
                        </h5>
                        
                        <!-- Fila de tipo, monto, fecha y hora -->
                        <div class="transaction-form-grid">
                            <div class="transaction-form-item">
                                <label class="form-label fw-semibold">Tipo</label>
                                <select class="form-select" id="transactionType">
                                    <option value="seleccion">Selecciona el tipo</option>
                                    <option value="gasto">Gasto</option>
                                    <option value="ingreso">Ingreso</option>
                                </select>
                            </div>
                            <div class="transaction-form-item">
                                <label class="form-label fw-semibold">S/. monto</label>
                                <input type="number" class="form-control" id="transactionAmount" placeholder="0.00" step="0.01">
                            </div>
                            <div class="transaction-form-item">
                                <label class="form-label fw-semibold">Fecha y Hora</label>
                                <input type="datetime-local" class="form-control" id="transactionDateTime">
                            </div>
                        </div>

                        <!-- Fila para imagen y descripción -->
                        <div class="datetime-row">
                            <div class="transaction-form-item">
                                <label class="form-label fw-semibold">Imagen</label>
                                <!-- Preview de imagen -->
                                <div class="image-preview" id="imagePreview" onclick="document.getElementById('imageInput').click()">
                                    <div class="image-preview-placeholder">
                                        <i class="bi bi-image"></i>
                                        <small>Haz clic para seleccionar imagen</small>
                                    </div>
                                </div>
                                <input type="file" id="imageInput" accept="image/*" style="display: none;">
                            </div>
                            <div class="transaction-form-item">
                                <label class="form-label fw-semibold">Descripción</label>
                                <input type="text" class="form-control" id="transactionDescription" placeholder="Descripción de la transacción...">
                            </div>
                        </div>

                        <!-- SELECCIONA CATEGORÍA -->
                        <div class="section-divider"></div>
                        
                        <h6 class="d-flex align-items-center gap-2 mb-3">
                            <i class="bi bi-tags text-primary"></i> Selecciona Categoría
                        </h6>
                        
                        <!-- Botones de categoría -->
                        <div class="category-buttons">
                            <button class="category-btn" data-category="comida">
                                <i class="bi bi-cup-straw"></i> Comida
                            </button>
                            <button class="category-btn" data-category="salud">
                                <i class="bi bi-heart-pulse"></i> Salud
                            </button>
                            <button class="category-btn" data-category="salario">
                                <i class="bi bi-cash-coin"></i> Salario
                            </button>
                            <button class="category-btn" data-category="entretenimiento">
                                <i class="bi bi-controller"></i> Entretenimiento
                            </button>
                            <button class="category-btn" data-category="transporte">
                                <i class="bi bi-car-front"></i> Transporte
                            </button>
                            <button class="category-btn" data-category="hogar">
                                <i class="bi bi-house"></i> Hogar
                            </button>
                            <button class="category-btn" data-category="compras">
                                <i class="bi bi-bag"></i> Compras
                            </button>
                            <button class="category-btn" data-category="educacion">
                                <i class="bi bi-book"></i> Educación
                            </button>
                            <button class="category-btn" id="personalize-categories-btn">
                                <i class="bi bi-sliders"></i> Personalizar
                            </button>
                        </div>
                        
                        <div class="d-flex justify-content-end mt-3">
                            <!-- Botón principal para agregar la transacción -->
                            <button class="btn btn-primary" id="addTransactionBtn">
                                <i class="bi bi-plus-circle me-2"></i> Agregar Transacción
                            </button>
                        </div>
                    </div>

                    <!-- TABLA DE TRANSACCIONES -->
                    <div class="table-card fade-in">
                        <h5 class="d-flex align-items-center gap-2 mb-3">
                            <i class="bi bi-table text-primary"></i> Tabla de Transacciones
                        </h5>
                        
                        <div class="section-divider"></div>
                        
                        <h6 class="fw-bold mb-3">Setiembre 2025</h6>
                        
                        <div class="table-responsive">
                            <table class="table align-middle">
                                <thead>
                                    <tr>
                                        <th>Categoría</th>
                                        <th>Tipo</th>
                                        <th>Importe</th>
                                        <th>Nota</th>
                                        <th>Imagen</th>
                                        <th>Fecha y Hora</th>
                                        <th class="text-end">Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="transactionsTableBody">
                                    <!-- Las transacciones se cargarán dinámicamente aquí -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- SECCIÓN INFORMES -->
                <section id="informes" class="content-section">
                    <!-- Filtros -->
                    <div class="row mb-4">
                        <div class="col-lg-12">
                            <div class="filters-card">
                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="filter-group">
                                            <div class="filter-label">Periodo</div>
                                            <div class="btn-group w-100">
                                                <button class="btn btn-sm btn-outline-secondary">Semanal</button>
                                                <button class="btn btn-sm btn-outline-primary active">Mensual</button>
                                                <button class="btn btn-sm btn-outline-secondary">Anual</button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="filter-group">
                                            <div class="filter-label">Exportar</div>
                                            <div class="d-flex gap-2">
                                                <!-- Botones para exportar reportes. Añadir handlers para generar PDF/CSV -->
                                                <button class="btn btn-sm btn-outline-primary flex-fill"><i class="bi bi-filetype-pdf me-1"></i> PDF</button>
                                                <button class="btn btn-sm btn-outline-success flex-fill"><i class="bi bi-file-earmark-excel me-1"></i> CSV</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Charts -->
                    <div class="row">
                        <!-- Ingresos vs. Gastos -->
                        <div class="col-lg-6 mb-4">
                            <div class="card-report">
                                <h5 class="d-flex align-items-center gap-2">
                                    <i class="bi bi-bar-chart-fill text-success"></i> Ingresos vs. Gastos
                                </h5>
                                <p class="muted mb-3">Comparativa mensual de ingresos y gastos</p>
                                <div class="chart-container">
                                    <!-- Canvas que usará Chart.js -->
                                    <canvas id="incomeExpensesChart"></canvas>
                                </div>
                            </div>
                        </div>

                        <!-- Distribución de Gastos por Categoría -->
                        <div class="col-lg-6 mb-4">
                            <div class="card-report">
                                <h5 class="d-flex align-items-center gap-2">
                                    <i class="bi bi-pie-chart-fill text-warning"></i> Distribución de Gastos por Categoría
                                </h5>
                                <p class="muted mb-3">Porcentaje de gastos en cada categoría</p>
                                <div class="chart-container">
                                    <canvas id="expensesChart"></canvas>
                                </div>
                            </div>
                        </div>

                        <!-- Evolución de tu Balance -->
                        <div class="col-lg-12 mb-4">
                            <div class="card-report">
                                <h5 class="d-flex align-items-center gap-2">
                                    <i class="bi bi-graph-up-arrow text-info"></i> Evolución de tu Balance
                                </h5>
                                <p class="muted mb-3">Tendencia de tu balance en los últimos meses</p>
                                <div class="chart-container">
                                    <canvas id="balanceChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- SECCIÓN PERFIL -->
                <section id="perfil" class="content-section">
                    <div class="card-stat fade-in mb-4">
                        <div class="profile-header">
                            <div class="profile-info">
                                <div class="profile-name" id="profileName">Usuario</div>
                                <div class="profile-email" id="profileEmail">correo@ejemplo.com</div>
                            </div>
                            <div class="profile-avatar" id="profileAvatar">
                                <div id="avatarPlaceholder" style="width:100%;height:100%;background:linear-gradient(135deg,var(--verdeOs),var(--grisOs));display:flex;align-items:center;justify-content:center;color:white;font-weight:bold;font-size:2rem;">JC</div>
                            </div>
                            <button class="btn btn-outline-primary" id="editProfileBtn">
                                <i class="bi bi-pencil me-1"></i> Editar
                            </button>
                        </div>

                        <!-- Formulario de edición de perfil -->
                        <div id="profileForm" style="display: none;">
                            <div class="section-divider"></div>
                            
                            <h5 class="mb-3">Información Personal</h5>
                            <form>
                                <div class="profile-picture-edit">
                                    <div class="profile-picture-preview" id="profilePicturePreview">
                                        <img id="profilePictureImage" src="" alt="Foto de perfil" onerror="this.style.display='none'">
                                        <div id="profilePicturePlaceholder" style="width:100%;height:100%;background:linear-gradient(135deg,var(--verdeOs),var(--grisOs));display:flex;align-items:center;justify-content:center;color:white;font-weight:bold;font-size:3rem;">JC</div>
                                    </div>
                                    <button type="button" class="profile-picture-change-btn" onclick="document.getElementById('avatarInput').click()">
                                        <i class="bi bi-camera me-1"></i> Cambiar foto de perfil
                                    </button>
                                    <input type="file" id="avatarInput" accept="image/*" style="display: none;">
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="firstName" class="form-label">Nombre</label>
                                        <input type="text" class="form-control" id="firstName" value="Jairo">
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="lastName" class="form-label">Apellido</label>
                                        <input type="text" class="form-control" id="lastName" value="Castillo">
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label for="userEmail" class="form-label">Correo electrónico</label>
                                    <input type="email" class="form-control" id="userEmail" value="jairo@utp.edu.pe">
                                </div>
                                <div class="mb-3">
                                    <label for="userPhone" class="form-label">Edad</label>
                                    <input type="number" class="form-control" id="userEdad" value="20">
                                </div>
                                
                                <!-- Cambio de contraseña -->
                                <h5 class="mb-3 mt-4">Cambiar Contraseña</h5>
                                <div class="mb-3">
                                    <label for="currentPassword" class="form-label">Contraseña actual</label>
                                    <input type="password" class="form-control" id="currentPassword">
                                </div>
                                <div class="mb-3">
                                    <label for="newPassword" class="form-label">Nueva contraseña</label>
                                    <input type="password" class="form-control" id="newPassword">
                                </div>
                                <div class="mb-3">
                                    <label for="confirmPassword" class="form-label">Confirmar nueva contraseña</label>
                                    <input type="password" class="form-control" id="confirmPassword">
                                </div>
                                
                                <div class="d-flex justify-content-end gap-2">
                                    <button type="button" class="btn btn-secondary" id="cancelEditBtn">Cancelar</button>
                                    <button type="submit" class="btn btn-primary">Guardar Cambios</button>
                                </div>
                            </form>
                        </div>

                        <div class="section-divider"></div>

                        <!-- Configuración de notificaciones -->
                        <div class="settings-option">
                            <div class="settings-option-label">
                                <i class="bi bi-bell"></i>
                                <div>
                                    <div class="fw-semibold">Notificaciones</div>
                                    <div class="small muted">Activa o desactiva las notificaciones</div>
                                </div>
                            </div>
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="notificationsSwitch" checked>
                            </div>
                        </div>

                        <div class="settings-option">
                            <div class="settings-option-label">
                                <i class="bi bi-telephone"></i>
                                <div>
                                    <div class="fw-semibold">Centro de Contacto</div>
                                    <div class="small muted">Contacta con nuestro equipo de soporte</div>
                                </div>
                            </div>
                        </div>

                        <div class="settings-option">
                            <div class="settings-option-label">
                                <i class="bi bi-gear"></i>
                                <div>
                                    <div class="fw-semibold">Ajustes</div>
                                    <div class="small muted">Configuración general de la aplicación</div>
                                </div>
                            </div>
                        </div>

                        <div class="settings-option">
                            <div class="settings-option-label">
                                <i class="bi bi-share"></i>
                                <div>
                                    <div class="fw-semibold">Compartir cuenta</div>
                                    <div class="small muted">Comparte tu cuenta con otros usuarios</div>
                                </div>
                            </div>
                        </div>

                        <div class="section-divider"></div>

                        <!-- Botón de cerrar sesión -->
                        <div class="d-grid">
                            <a class="btn btn-outline-danger" href="/frontend/src/pages/Autenticación/login.html" role="button" aria-label="Cerrar sesión">
                                <i class="bi bi-box-arrow-right me-2" aria-hidden="true"></i> Cerrar Sesión
                            </a>
                        </div>

                        <!-- Sección de suscripción Premium -->
                        <div class="premium-card">
                            <h3 class="premium-title">Hazte Premium</h3>
                            <p class="muted">Desbloquea todas las funciones premium</p>
                            
                            <table class="premium-price-table">
                                <tr>
                                    <td>Anual</td>
                                    <td>S/.18.99</td>
                                </tr>
                                <tr>
                                    <td>Mensual</td>
                                    <td>S/.3.69</td>
                                </tr>
                                <tr>
                                    <td>Pago único</td>
                                    <td>S/.49.99</td>
                                </tr>
                            </table>
                            
                            <button class="btn btn-primary w-100 mt-3">
                                <i class="bi bi-star-fill me-2"></i> Suscribirse
                            </button>
                        </div>
                    </div>
                </section>
            </main>
        </div>
    </div>

    <!-- Botón flotante para añadir transacción -->
    <button class="floating-add-btn" id="floatingAddBtn">
        <i class="bi bi-plus"></i>
    </button>

    <!-- Modal para ver imagen -->
    <div class="modal fade" id="imageModal" tabindex="-1" aria-labelledby="imageModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="imageModalLabel">Imagen de la Transacción</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body text-center">
                    <img id="modalImage" class="modal-image" src="" alt="Imagen de transacción">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para ver detalles de transacción -->
    <div class="modal fade transaction-detail-modal" id="viewTransactionModal" tabindex="-1" aria-labelledby="viewTransactionModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="transaction-detail-header">
                    <h5 class="modal-title mb-0" id="viewTransactionModalLabel">Detalles de la Transacción</h5>
                </div>
                <div class="transaction-detail-body" id="viewTransactionModalBody">
                    <!-- Los detalles se cargarán aquí -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para editar transacción -->
    <div class="modal fade transaction-edit-modal" id="editTransactionModal" tabindex="-1" aria-labelledby="editTransactionModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="transaction-edit-header">
                    <h5 class="modal-title mb-0" id="editTransactionModalLabel">Editar Transacción</h5>
                </div>
                <div class="transaction-edit-body" id="editTransactionModalBody">
                    <!-- El formulario de edición se cargará aquí -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" id="saveTransactionBtn">Guardar Cambios</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
     <script>
// ...otros scripts...
document.getElementById('logoutBtn').addEventListener('click', function() {
    // Aquí puedes limpiar el almacenamiento local/session si usas tokens
    // localStorage.removeItem('token');
    window.location.href = '/frontend/src/pages/Autenticación/login.html';
});
</script>

<script>
// Obtener el nombre del usuario desde localStorage
const nombreUsuario = localStorage.getItem('nombreUsuario') || 'Usuario';
// Cambiar el nombre en la topbar
document.addEventListener('DOMContentLoaded', function() {
    document.querySelector('#main-title .text-gradient').textContent = nombreUsuario;
    // Si quieres cambiar otros lugares, hazlo aquí también
});
</script>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/frontend/src/pages/Usuario/usuario.js"></script>
</body>
</html>